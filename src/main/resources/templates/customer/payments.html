<h3>üí≥ L·ªãch s·ª≠ thanh to√°n</h3>

<div id="paymentBox">ƒêang t·∫£i...</div>

<script>
    /* ============================
            LOAD USER FORMAT C≈®
    ============================= */
    function getUser(){
        return JSON.parse(localStorage.getItem("user") || "{}");
    }

    /* ============================
              LOAD PAYMENTS
    ============================= */
    async function loadPayments(){
        let user = getUser();

        if(!user.id){
            paymentBox.innerHTML = "<p class='text-danger'>Kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c ng∆∞·ªùi d√πng!</p>";
            return;
        }

        // L·∫•y danh s√°ch payment c√≥ order thu·ªôc user
        let res = await fetch("/api/payments");
        let allPayments = await res.json();

        // L·ªçc theo ƒë√∫ng user
        let list = allPayments.filter(p =>
            p.order?.customer?.id === user.id
        );

        if(list.length === 0){
            paymentBox.innerHTML = "<p class='text-muted'>Ch∆∞a c√≥ giao d·ªãch thanh to√°n.</p>";
            return;
        }

        let html = "";

        list.forEach(p=>{
            let amount = p.amount ? p.amount.toLocaleString() : "0";
            let created = p.createdAt ? new Date(p.createdAt).toLocaleString("vi-VN") : "Kh√¥ng r√µ";

            html += `
        <div class="border rounded p-3 mb-3">
            <h5>Payment #${p.id}</h5>
            <p><b>ƒê∆°n h√†ng:</b> ${p.order?.id || "Kh√¥ng r√µ"}</p>
            <p><b>Ph∆∞∆°ng th·ª©c:</b> ${p.method}</p>
            <p><b>S·ªë ti·ªÅn:</b> <span class="text-danger fw-bold">${amount}ƒë</span></p>
            <p><b>Tr·∫°ng th√°i:</b> ${p.status}</p>
            <p><b>Ng√†y t·∫°o:</b> ${created}</p>
        </div>
        `;
        });

        paymentBox.innerHTML = html;
    }

    loadPayments();
</script>
